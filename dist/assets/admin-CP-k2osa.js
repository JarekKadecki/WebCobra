import{r as e,j as t,c as n,R as s}from"./client-DcDfWwca.js";import"./phaser-DZy_kcLU.js";const r=({selectCallback:n})=>{const[s,r]=e.useState([]);return e.useEffect((()=>{(async()=>{const e=await fetch("/api/get_studies",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),t=await e.json();console.log(`recived studies: ${JSON.stringify(t)}.`),r(t)})()}),[]),t.jsxs("select",{onChange:e=>n(e.target.value),defaultValue:"",children:[t.jsx("option",{value:"",disabled:!0,children:"Select study"}),s.map((e=>t.jsx("option",{value:e,children:e},e)))]})},a=()=>{const[n,s]=e.useState(""),[a,o]=e.useState("");return t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),a){if("add"==a){const e={study:document.getElementById("addStudyInput").value};try{const t=await fetch("/api/add_study",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});console.log(`Study ${e.study} sent to be added.`),t.ok&&alert(`Study ${e.study} sent to be added.`)}catch(t){console.error("add_study failed:",t),alert("Submission failed.")}}if("remove"==a){const e={study:n};try{await fetch("/api/remove_study",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),console.log(`Study ${n} sent to be removed.`)}catch(t){console.error("remove_study failed:",t),alert("Submission failed.")}}}else alert("Select a study to add or to remove.")},children:[t.jsx("button",{type:"button",onClick:()=>o("add"),children:"Add Study"}),t.jsx("button",{type:"button",onClick:()=>o("remove"),children:"Remove Study"}),t.jsx("br",{}),"add"==a&&t.jsxs(t.Fragment,{children:[t.jsx("label",{children:"Select name of new study"}),t.jsx("br",{}),t.jsx("input",{type:"text",id:"addStudyInput"}),t.jsx("br",{})]}),"remove"==a&&t.jsxs(t.Fragment,{children:[t.jsx("label",{children:"Select study to remove "}),t.jsx("br",{}),t.jsx(r,{selectCallback:s}),t.jsx("br",{})]}),a&&t.jsx("button",{type:"submit",children:"Submit"})]})},o=({study:n,editionField:s,updateOnSubmit:r,api:a})=>{const[o,i]=e.useState("");let d="?";switch(a){case"/api/get_configuration":d="Configuration";break;case"/api/get_questions":d="Questions";break;case"/api/get_report":d="Report";break;default:d="?"}return t.jsx("button",{type:"button",onClick:async()=>{r();try{const e=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({study:n})});if(!e.ok)throw new Error("API request failed");const t=await e.json(),r=JSON.stringify(t,null,2);document.getElementById(s).value="",document.getElementById(s).value=r,i(r)}catch(e){console.error("Error fetching data:",e)}},children:d})},i=()=>{const[n,s]=e.useState(""),[a,i]=e.useState(""),[d,l]=e.useState(""),[c,u]=e.useState(""),y="editionArea",b=e=>()=>{i(`/api/set_${e}`),l(e)};return t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!d||!n)return void alert(`Select a study ${n} and an action ${d} before submitting.`);const t={study:n,fieldToUpdate:d,value:c},s=await fetch("/api/set_questions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(s.ok)document.getElementById("errorMessage").innerHTML="";else{const e=await s.text();console.error("Submission failed:",e),document.getElementById("errorMessage").innerHTML=e}s.ok&&alert("Changes submitted")},children:[t.jsx(r,{selectCallback:s}),t.jsx("br",{}),n&&t.jsxs(t.Fragment,{children:[t.jsx(o,{study:n,editionField:y,updateOnSubmit:b("configuration"),api:"/api/get_configuration"}),t.jsx(o,{study:n,editionField:y,updateOnSubmit:b("questions"),api:"/api/get_questions"}),t.jsx("br",{}),t.jsx("label",{id:"errorMessage"}),t.jsx("textarea",{id:y,value:c,onChange:e=>u(e.target.value),rows:12,style:{width:"100%",marginTop:"1em"}}),t.jsx("br",{}),d&&t.jsxs(t.Fragment,{children:[t.jsxs("label",{children:["Changing ",t.jsx("b",{children:d})," of ",t.jsx("b",{children:n}),"."]}),t.jsx("br",{})]}),t.jsx("button",{type:"submit",children:"Edit data"})]})]})},d=()=>{const[n,s]=e.useState(""),[a,o]=e.useState(0);return t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!n)return void alert("Select a study to generate keys.");if(!a||Number(a)<=0)return void alert("Select number of keys to generate.");const t={number:a,study:n},s=await fetch("/api/generate_keys",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log(`Generating ${a} keys for ${n}.`),s.ok){const e=await fetch("/api/get_keys",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=(await e.json()).join("\n"),s=new Blob([n],{type:"text/plain"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download="keys.txt",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}else s.ok||(console.error("generate_keys failed:"),alert("Submission failed."))},children:[t.jsx("label",{children:"Select study"}),t.jsx("br",{}),t.jsx(r,{selectCallback:s}),t.jsx("br",{}),t.jsx("label",{children:"Provide number o keys to generate"}),t.jsx("br",{}),t.jsx("input",{type:"number",id:"numberInput",onChange:e=>o(Number(e.target.value)),min:"0"}),t.jsx("br",{}),t.jsx("button",{type:"submit",children:"Submit"})]})};function l(e){if(null==e)return"";let t=String(e);return(t.includes('"')||t.includes(",")||t.includes("\n"))&&(t='"'+t.replace(/"/g,'""')+'"'),t}const c=()=>{const[n,s]=e.useState("");return t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!n)return void alert("Select a study to generate report.");const t={study:n},s=await fetch("/api/generate_report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log(`Generating report for ${n}.`),s.ok){const e=function(e){if(!e||!Array.isArray(e))return"";const t=new Set,n=new Set;e.forEach((e=>{const s=e.answers||{};Object.keys(s).forEach((e=>t.add(e)));const r=e.stats||{};Object.keys(r).forEach((e=>{const t=r[e];Array.isArray(t)?t.forEach(((t,s)=>n.add(`${e}${s}`))):n.add(e)}))}));const s=Array.from(t),r=Array.from(n),a=["hash",...s,...r],o=e.map((e=>{const t=e.answers||{},n=e.stats||{},a={};return r.forEach((e=>{const t=e.replace(/\d+$/,""),s=parseInt(e.replace(t,""),10),r=n[t];a[e]=Array.isArray(r)?r[s]??"":r??""})),[e.hash,...s.map((e=>t[e]??"")),...r.map((e=>a[e]??""))]}));return[a.join(","),...o.map((e=>e.map(l).join(",")))].join("\n")}(await s.json()),t=new Blob([e],{type:"text/csv"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=`report_${n}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}else s.ok||(console.error("generate_report failed:",err),alert("Submission failed."))},children:[t.jsx("label",{children:"Select study"}),t.jsx("br",{}),t.jsx(r,{selectCallback:s}),t.jsx("br",{}),t.jsx("button",{type:"submit",children:"Generate"})]})},u=()=>{const[n,s]=e.useState();return t.jsxs(t.Fragment,{children:[t.jsxs("div",{id:"leftAdminPanel",children:[t.jsx("label",{children:"Choose panel"}),t.jsxs("div",{children:[t.jsx("button",{class:"leftAdminPanelButtons",onClick:()=>s("addRemove"),children:"Add/Remove study"}),t.jsx("br",{}),t.jsx("button",{class:"leftAdminPanelButtons",onClick:()=>s("edit"),children:"Edit study"}),t.jsx("br",{}),t.jsx("button",{class:"leftAdminPanelButtons",onClick:()=>s("generateKeys"),children:"Generate keys"}),t.jsx("br",{}),t.jsx("button",{class:"leftAdminPanelButtons",onClick:()=>s("generateReport"),children:"Generate Report"}),t.jsx("br",{})]})]}),t.jsxs("div",{id:"centralAdminPanel",children:["addRemove"==n&&t.jsx(a,{}),"edit"==n&&t.jsx(i,{}),"generateKeys"==n&&t.jsx(d,{}),"generateReport"==n&&t.jsx(c,{})]})]})};n.createRoot(document.getElementById("root")).render(t.jsx(s.StrictMode,{children:t.jsx(u,{})}));
