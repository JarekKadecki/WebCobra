// Use DBML to define your database structure
// Docs: https://dbml.dbdiagram.io/docs

Table studies {
  id integer [primary key]
  name varchar
  created_at timestamp
  configuration varchar2
  questions varchar2
}

Table users {
  id integer [primary key]
  email varchar
  created_at timestamp
}

Table participations {
  id integer [primary key]
  user_id integer
  study_id integer
  hash varchar [unique]
  finished boolean
  stats varchar2
  answers varchar2
  date timestamp
}


varchar2 == json

Ref user_participations: participations.user_id > users.id

Ref studies_participations: participations.study_id > studies.id

#study_admin a41b09a8d0c4

psql -U study_admin -d study_db;
sea-orm-cli generate entity -u postgres://study_admin:a41b09a8d0c4@localhost:5432/study_db -o src/models
add "pub mod validate_request;" to models/mod.rs


\du         - list users
\l          - list databases
\dt         - list tables
\d table    - describes table
\c database - switch to database

CREATE DATABASE study_db;

CREATE TABLE studies (
    id SERIAL PRIMARY KEY,
    name VARCHAR,
    created_at TIMESTAMP,
    configuration TEXT
);

CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR,
    created_at TIMESTAMP
);

CREATE TABLE participations (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    study_id INTEGER REFERENCES studies(id),
    hash VARCHAR UNIQUE,
    finished BOOLEAN,
    answers TEXT,
    date TIMESTAMP
);


Opponent.rank 100 : score 12
win                                     
Player.rank 46 : player.score           
->
Opponent rank player.rank/2 : score player.score + applesCount + 3
win                                       lose
Player rank 20  : player.score ...        player.score+ ? player.rank-=11 : player.rank

Running backend
RUST_LOG=info cargo run

Write uniwersal api for data handling

get_questions
get_configuration
add_study
remove_study
generate_keys
submit_results
submit_answers

api/get_questions -> POST -> retrives studies.questions based on hash stored in session
api/get_configuration -> POST -> retrives studies.configuration based on hash stored in session
api/add_study -> POST -> transfers json data with study.name, adds new entry in studies table with default configuration
api/remove_study -> POST -> removes entry from studies table basing on name transfered in json data
api/generate_keys -> POST -> creates number of entries in participations table, number and studyName are stored in transferred json
api/submit_results -> POST -> updates participations.stats with data stored in JSON basing hash stored in session
api/submit_aswers -> POST -> updates participations.answers with data stored in JSON basing on hash stored in session
Mentioned hash can lead to study_id that can lead to studies.id

to do:
  - poprawić api handler - nie zawsze czytać hashs przy wyciąganiu configuracji/questions
  - dodać sprawdzanie usera w sesji
  - dodać generowania raportu z badania
  - poprawić niewczytujące css
  - prztestować wstawianie wyników badania do bazy danych

{
 "questions": [
  {
   "title": "What is the answer to question1?",
   "answers": ["q1_answer1", "q1_answer2", "q1_answer3", "q1_answer4"]
  },
 {
   "title": "What is the answer to question2?",
   "answers": ["q2_answer1", "q2_answer2", "q2_answer3", "q2_answer4"]
  },
 {
   "title": "What is the answer to question3?",
   "answers": ["q3_answer1", "q3_answer2", "q3_answer3", "q3_answer4"]
  }
 ]
}